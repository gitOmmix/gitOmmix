#!/usr/bin/env bash
set -e

export PATIENT=HPV
export DEBUG=verbose

mkdir -p "tests/$PATIENT"
cd "tests/$PATIENT"

echo "Anal biopsy" > data_anal_path
echo "Lung biopsy" > data_b2
echo "Blood sample" > data_blood
echo "Bone biopsy" > data_b3

echo "Malignant anal epithelial cells" > result_anal_path
echo "Malignant epithelial lung cells" > result_b2
echo "Circulating DNA matching markers from the gastric and lung cells" > result_blood
echo "Malignant bone cells" > result_b3

rm -rf ~/GitOmmix/$PATIENT

git-ommix add patient --id $PATIENT

export SAMPLE=Anal_biopsy
git-ommix add sample    --id $SAMPLE
git-ommix add data      --id ${SAMPLE}_pathology data_anal_path
git-ommix add result    --id ${SAMPLE}_pathology --use ${SAMPLE}_pathology --method pathology --provider "Badoual <cecile.badoual@aphp.fr>" result_anal_path
git-ommix add diagnosis --id Anal_carcinoma_T2   --use ${SAMPLE}_pathology 

git-ommix add data      --id ${SAMPLE}_NGS data_anal_NGS
git-ommix add result    --id ${SAMPLE}_NGS         --use ${SAMPLE}_NGS             --method HPV_capture --provider "Veyer <david.veyer@aphp.fr>" result_anal_ngs
git-ommix add diagnosis --id Anal_carcinoma_T2_HPV --revision_of Anal_carcinoma_T2 --use ${SAMPLE}_NGS 

export SAMPLE=blood1
git-ommix add sample --id $SAMPLE
git-ommix add data   --id $SAMPLE data_blood1
git-ommix add result --id $SAMPLE --use $SAMPLE --method HPV_capture --provider "Veyer <david.veyer@aphp.fr>" result_blood1_HPV

export SAMPLE=blood2
git-ommix add sample --id $SAMPLE
git-ommix add data   --id $SAMPLE data_blood2
git-ommix add result --id $SAMPLE --use $SAMPLE --method HPV_capture --provider "Veyer <david.veyer@aphp.fr>" result_blood2_HPV

export SAMPLE=blood3
git-ommix add sample --id $SAMPLE
git-ommix add data   --id $SAMPLE data_blood3
git-ommix add result --id $SAMPLE --use $SAMPLE --method HPV_capture --provider "Veyer <david.veyer@aphp.fr>" result_blood3_HPV

export SAMPLE=Bone_biopsy
git-ommix add sample    --id $SAMPLE
git-ommix add data      --id ${SAMPLE}_pathology data_bone_path
git-ommix add result    --id ${SAMPLE}_pathology --use ${SAMPLE}_pathology --method pathology --provider "Badoual <cecile.badoual@aphp.fr>" result_bone_path
git-ommix add diagnosis --id Bone_carcinoma_T1   --use ${SAMPLE}_pathology 

git-ommix add data      --id ${SAMPLE}_NGS data_bone_NGS
git-ommix add result    --id ${SAMPLE}_NGS            --use ${SAMPLE}_NGS                 --method HPV_capture           --provider "Veyer <david.veyer@aphp.fr>" result_bone_ngs
git-ommix add diagnosis --id Anal_metastasis_T2M1_HPV --revision_of Anal_carcinoma_T2_HPV --invalidate Bone_carcinoma_T1 --use ${SAMPLE}_NGS 

git-ommix add diagnosis --id HPV_HGAIN_T2N1M1 --revision_of Anal_metastasis_T2M1_HPV --use blood1 --use blood2 --use blood3 
