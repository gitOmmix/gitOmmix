#!/bin/env bash
set -e

export PATIENT=operations
export DEBUG=verbose

mkdir -p "tests/$PATIENT"
cd "tests/$PATIENT"

rm ~/GitOmmix/$PATIENT -rf

git-ommix add patient --id $PATIENT

export SAMPLE=simple
echo "$SAMPLE" > $SAMPLE
git-ommix add sample --id $SAMPLE
git-ommix add data --id $SAMPLE $SAMPLE
git-ommix add result --use $SAMPLE --id $SAMPLE $SAMPLE
git-ommix add diagnosis --use $SAMPLE --id $SAMPLE

export SAMPLE=more
echo "$SAMPLE" > $SAMPLE
git-ommix add sample --id $SAMPLE
git-ommix add data --id $SAMPLE $SAMPLE
git-ommix add result --use $SAMPLE --id $SAMPLE $SAMPLE
echo $SAMPLE"2" > $SAMPLE"2"
git-ommix add data --id $SAMPLE"2" $SAMPLE"2"
git-ommix add result --use $SAMPLE"2" --id $SAMPLE"2" $SAMPLE"2"
git-ommix add diagnosis --use $SAMPLE --use $SAMPLE"2" --id $SAMPLE

export SAMPLE=update
echo "$SAMPLE" > $SAMPLE
git-ommix add sample --id $SAMPLE
git-ommix add data --id $SAMPLE $SAMPLE
git-ommix add result --use $SAMPLE --id $SAMPLE $SAMPLE
echo $SAMPLE"2" > $SAMPLE"2"
git-ommix add result --use $SAMPLE --revision_of $SAMPLE --invalidate $SAMPLE --method new_analysis --id $SAMPLE"2" $SAMPLE"2"
git-ommix add diagnosis --use $SAMPLE"2" --id $SAMPLE

export SAMPLE=original
echo "$SAMPLE" > $SAMPLE
git-ommix add sample --id $SAMPLE
git-ommix add data --id $SAMPLE $SAMPLE
git-ommix add result --use $SAMPLE --id $SAMPLE $SAMPLE
git-ommix add diagnosis --use $SAMPLE --id $SAMPLE

export SAMPLE=updated
echo "$SAMPLE" > $SAMPLE
git-ommix add sample --id $SAMPLE
git-ommix add data --id $SAMPLE $SAMPLE
git-ommix add result --use $SAMPLE --id $SAMPLE $SAMPLE
git-ommix add diagnosis --use $SAMPLE --revision_of original --invalidate original --method updated_interpretation --id $SAMPLE 

export SAMPLE=first
echo "$SAMPLE" > $SAMPLE
git-ommix add sample --id $SAMPLE
git-ommix add data --id $SAMPLE $SAMPLE
git-ommix add result --use $SAMPLE --id $SAMPLE $SAMPLE
git-ommix add diagnosis --use $SAMPLE --id $SAMPLE

export SAMPLE=second
echo "$SAMPLE" > $SAMPLE
git-ommix add sample --id $SAMPLE
git-ommix add data --id $SAMPLE $SAMPLE
git-ommix add result --use $SAMPLE --id $SAMPLE $SAMPLE
git-ommix add diagnosis --use $SAMPLE --id $SAMPLE

git-ommix add diagnosis --use diagnosis:first --use diagnosis:second --id combined